JX.behavior('diffusion-pull-lastmodified',function(config){new
JX.Workflow(config.uri,{paths:JX.JSON.stringify(JX.keys(config.map))}).setHandler(function(r){for(var
k
in
r){for(var
l
in
r[k]){if(!config.map[k][l]){continue;}try{JX.DOM.setContent(JX.$(config.map[k][l]),JX.$H(r[k][l]));}catch(ex){}}}}).start();});JX.behavior('diffusion-commit-graph',function(config){var
nodes=JX.DOM.scry(document.body,'div','commit-graph');var
cxt;function
color(c){var
colors=['#cc0000','#cc0099','#6600cc','#0033cc','#00cccc','#00cc33','#66cc00','#cc9900'];return colors[c%colors.length];}function
lstroke(c){cxt.lineWidth=3;cxt.strokeStyle='#ffffff';cxt.stroke();cxt.lineWidth=1;cxt.strokeStyle=color(c);cxt.stroke();}function
fstroke(c){cxt.lineWidth=1;cxt.fillStyle=color(c);cxt.strokeStyle='#ffffff';cxt.fill();cxt.stroke();}var
default_width;if(config.count>=8){default_width=6;}else{default_width=12;}for(var
ii=0;ii<nodes.length;ii++){var
data=JX.Stratcom.getData(nodes[ii]);var
cell=default_width;var
xpos=function(col){return(col*cell)+(cell/2);};var
h=34;var
w=cell*config.count;var
canvas=JX.$N('canvas',{width:w,height:h});cxt=canvas.getContext('2d');cxt.lineWidth=3;cxt.translate(0.5,0.5);cxt.strokeStyle='#ffffff';cxt.fillStyle='#ffffff';var
origin=null;var
jj;var
x;var
c;for(jj=0;jj<data.line.length;jj++){c=data.line.charAt(jj);switch(c){case'o':case'x':case'^':origin=xpos(jj);break;}}for(jj=0;jj<data.join.length;jj++){var
join=data.join[jj];x=xpos(join);cxt.beginPath();cxt.moveTo(x,0);cxt.bezierCurveTo(x,h/4,origin,h/4,origin,h/2);lstroke(join);}for(jj=0;jj<data.split.length;jj++){var
split=data.split[jj];x=xpos(split);cxt.beginPath();cxt.moveTo(origin,h/2);cxt.bezierCurveTo(origin,3*h/4,x,3*h/4,x,h);lstroke(split);}for(jj=0;jj<data.line.length;jj++){c=data.line.charAt(jj);switch(c){case'o':case'^':case'|':case'x':case'X':if(c!=='X'){cxt.beginPath();cxt.moveTo(xpos(jj),(c=='^'?h/2:0));cxt.lineTo(xpos(jj),(c=='x'?h/2:h));lstroke(jj);}if(c=='o'||c=='^'||c=='x'||c=='X'){cxt.beginPath();cxt.arc(xpos(jj),h/2,3,0,2*Math.PI,true);fstroke(jj);}break;}}JX.DOM.setContent(nodes[ii],canvas);}});JX.behavior('audit-preview',function(config){var
content=JX.$(config.content);var
action=JX.$(config.action);var
callback=function(r){JX.DOM.setContent(JX.$(config.preview),JX.$H(r));};var
getdata=function(){return{action:action.value,content:content.value};};var
request=new
JX.PhabricatorShapedRequest(config.uri,callback,getdata);var
trigger=JX.bind(request,request.trigger);JX.DOM.listen(content,'keydown',null,trigger);JX.DOM.listen(action,'change',null,trigger);request.start();});